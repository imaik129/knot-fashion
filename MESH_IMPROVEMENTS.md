# 🎨 メッシュレンダリング改善ガイド

## 実装した改善点

### 1. **SMPL Facesの取得改善**
- SMPLモデルファイルから直接facesを読み込む機能を追加
- 6890頂点を検出した場合、標準SMPL face template（13776 faces）を使用
- 複数のパスでfacesを取得を試行（`smpl.faces`, `model.faces`, `body_model.faces`など）

### 2. **メッシュのスムージング**
- スムーズシェーディングを有効化（`flatShading: false`）
- 頂点法線の計算を改善
- マテリアルのroughnessを調整（0.6-0.7）してより滑らかな見た目に

### 3. **オーバーレイの位置合わせ**
- ビデオとメッシュの完全な位置合わせ
- 透明レイヤーの適切な設定
- デバイスピクセル比の最適化（`dpr={[1, 2]}`）

### 4. **レンダリング品質の向上**
- アンチエイリアシングの有効化
- より良いライティング設定（複数の方向光）
- 透明度の最適化

## 参考画像との比較

参考画像の特徴：
- ✅ 半透明の滑らかなメッシュ
- ✅ 体の輪郭に正確に沿っている
- ✅ ビデオの上に完璧にオーバーレイ
- ✅ 滑らかな表面（点群ではない）

現在の実装：
- ✅ 半透明メッシュ（不透明度75%）
- ✅ スムーズシェーディング
- ✅ ビデオオーバーレイ
- ⚠️ SMPL facesが取得できない場合、フォールバックが必要

## 次のステップ

### SMPL Facesの完全な取得

1. **SMPLモデルファイルをインストール**
   ```bash
   # https://smpl.is.tue.mpg.de/ からダウンロード
   cp ~/Downloads/basicModel_neutral_lbs_10_207_0_v1.1.0.pkl ~/.romp/SMPL_NEUTRAL.pth
   ```

2. **ROMPモデルから直接取得**
   - ROMPの初期化時にSMPL facesを保存
   - または、ROMPの出力からfacesを抽出

3. **標準SMPL face templateの使用**
   - SMPLの標準faces（13776 faces）をハードコード
   - GitHubリポジトリから取得

## トラブルシューティング

### メッシュが滑らかでない場合
- SMPL facesが正しく取得されているか確認
- `flatShading: false`が設定されているか確認
- 頂点法線が正しく計算されているか確認

### オーバーレイがずれている場合
- ビデオとCanvasのサイズが一致しているか確認
- カメラの位置とFOVが適切か確認
- メッシュの正規化が適切か確認

### メッシュが表示されない場合
- バックエンドのログでfacesが取得されているか確認
- フロントエンドのコンソールでエラーを確認
- メッシュの頂点数が6890か確認（SMPL標準）


